<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Keep all your existing head content -->
    <!-- ... -->
</head>
<body class="bg-gray-50">
    <!-- Keep all your existing HTML structure -->
    <!-- ... -->

    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <script type="module">
        // Import Firebase services with all required functions
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged,
            signOut 
        } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            query, 
            where, 
            getDocs,
            getDoc,
            addDoc,
            doc,
            updateDoc,
            deleteDoc,
            orderBy,
            serverTimestamp,
            writeBatch
        } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-firestore.js";
        import { 
            getStorage,
            ref,
            uploadBytes,
            getDownloadURL,
            deleteObject
        } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-storage.js";

        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyD11ABaNYrhHo5clZDpmuIanlGGRsW1-eU",
            authDomain: "sira-gebeya-job-market.firebaseapp.com",
            projectId: "sira-gebeya-job-market",
            storageBucket: "sira-gebeya-job-market.appspot.com",
            messagingSenderId: "460938974467",
            appId: "1:460938974467:web:703df4960cbd9941ba0536",
            measurementId: "G-65HYNHT5Q4"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // ===== Utility Functions =====
        function formatJobType(type) {
            const types = {
                'full-time': 'Full-time',
                'part-time': 'Part-time',
                'contract': 'Contract',
                'internship': 'Internship',
                'temporary': 'Temporary',
                'remote': 'Remote'
            };
            return types[type] || type;
        }

        function formatStatus(status) {
            return status.charAt(0).toUpperCase() + status.slice(1);
        }

        function getStatusClass(status) {
            return `status-${status}`;
        }

        function formatDate(date) {
            if (!date) return 'N/A';
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return date.toLocaleDateString(undefined, options);
        }

        let toastIdCounter = 0;
        function showToast(message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');
            const toastId = `toast-${toastIdCounter++}`;
            toast.id = toastId;
            toast.className = `fixed bottom-4 right-4 px-4 py-2 rounded-md shadow-lg text-white ${
                type === 'error' ? 'bg-red-500' : 
                type === 'success' ? 'bg-green-500' : 
                'bg-blue-500'
            }`;
            toast.textContent = message;
            document.body.appendChild(toast);

            if (duration > 0) {
                setTimeout(() => {
                    toast.remove();
                }, duration);
            }

            return toastId;
        }

        function dismissToast(id) {
            const toast = document.getElementById(id);
            if (toast) {
                toast.remove();
            }
        }

        function showConfirmation(title, message, callback) {
            document.getElementById('confirmationTitle').textContent = title;
            document.getElementById('confirmationMessage').textContent = message;
            
            const confirmBtn = document.getElementById('confirmAction');
            // Remove previous listeners to avoid duplicates
            confirmBtn.replaceWith(confirmBtn.cloneNode(true));
            document.getElementById('confirmAction').onclick = function() {
                callback();
                document.getElementById('confirmationModal').classList.add('hidden');
            };
            
            document.getElementById('confirmationModal').classList.remove('hidden');
        }

        // ===== Initialize Quill Editor =====
        const quill = new Quill('#jobDescriptionEditor', {
            theme: 'snow',
            modules: {
                toolbar: {
                    container: [
                        ['bold', 'italic', 'underline'],
                        [{ 'header': [1, 2, 3, false] }],
                        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                        ['link', 'image', 'file'],
                        ['clean']
                    ],
                    handlers: {
                        image: function() {
                            selectAndUploadFile('image/*');
                        },
                        file: function() {
                            selectAndUploadFile('*');
                        }
                    }
                }
            },
            placeholder: 'Enter detailed job description...',
            formats: ['bold', 'italic', 'underline', 'header', 'list', 'link', 'image', 'file']
        });

        // Custom file attachment format
        const FileAttachment = Quill.import('formats/link');
        class CustomFileAttachment extends FileAttachment {
            static create(value) {
                const node = super.create(value);
                if (typeof value === 'object' && value.url) {
                    node.setAttribute('href', value.url);
                    node.setAttribute('target', '_blank');
                    node.innerHTML = `
                        <span class="quill-file-attachment">
                            <i class="fas fa-file-alt mr-2"></i>
                            ${value.name || 'Download'}
                        </span>
                    `;
                }
                return node;
            }
        }
        Quill.register(CustomFileAttachment, true);

        // ===== File Upload Handler =====
        const fileHandler = {
            allowedTypes: [
                'image/jpeg', 'image/png', 'image/gif',
                'application/pdf',
                'application/msword',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                'application/vnd.ms-excel',
                'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
            ],
            maxSize: 5 * 1024 * 1024, // 5MB
            
            upload: async function(file) {
                const storageRef = ref(storage, `job-attachments/${auth.currentUser.uid}/${Date.now()}-${file.name}`);
                await uploadBytes(storageRef, file);
                const downloadURL = await getDownloadURL(storageRef);
                
                return {
                    id: storageRef.name,
                    name: file.name,
                    type: file.type,
                    size: file.size,
                    url: downloadURL,
                    storagePath: storageRef.fullPath
                };
            },
            
            remove: async function(fileData) {
                const fileRef = ref(storage, fileData.storagePath);
                await deleteObject(fileRef);
            }
        };

        function selectAndUploadFile(accept) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = accept;
            input.click();
            
            input.onchange = async function() {
                const file = input.files[0];
                if (!file) return;
                
                // Validate file
                if (!fileHandler.allowedTypes.includes(file.type)) {
                    showToast('File type not allowed', 'error');
                    return;
                }
                
                if (file.size > fileHandler.maxSize) {
                    showToast('File must be smaller than 5MB', 'error');
                    return;
                }
                
                const loadingId = showToast('Uploading file...', 'info', 0);
                
                try {
                    const fileData = await fileHandler.upload(file);
                    
                    // Insert into editor
                    const range = quill.getSelection();
                    if (fileData.type.startsWith('image/')) {
                        quill.insertEmbed(range.index, 'image', fileData.url);
                    } else {
                        quill.insertEmbed(range.index, 'link', {
                            url: fileData.url,
                            name: fileData.name
                        });
                    }
                    
                    dismissToast(loadingId);
                    showToast('File uploaded successfully', 'success');
                } catch (error) {
                    console.error("Upload failed:", error);
                    dismissToast(loadingId);
                    showToast('Upload failed: ' + error.message, 'error');
                }
            };
        }

        // ===== Job Management =====
        let currentJobs = [];
        let selectedJobs = [];
        let currentStatus = 'draft';
        let currentPage = 1;
        const jobsPerPage = 10;

        async function loadJobs(status, page = 1) {
            currentStatus = status;
            currentPage = page;
            const jobListings = document.getElementById('jobListings');
            jobListings.innerHTML = '<div class="text-center py-8 text-gray-500"><i class="fas fa-spinner fa-spin mr-2"></i> Loading jobs...</div>';
            
            try {
                const q = query(
                    collection(db, "jobs"),
                    where("companyId", "==", auth.currentUser.uid),
                    where("status", "==", status),
                    orderBy("updatedAt", "desc")
                );
                
                const querySnapshot = await getDocs(q);
                currentJobs = querySnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                if (currentJobs.length === 0) {
                    jobListings.innerHTML = `
                        <div class="text-center py-8">
                            <i class="fas fa-briefcase text-gray-400 text-4xl mb-3"></i>
                            <p class="text-gray-600">No ${status} jobs found</p>
                            ${status === 'draft' ? 
                                '<button id="createFirstJob" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium">Create your first job</button>' : 
                                ''}
                        </div>
                    `;
                    
                    if (status === 'draft') {
                        document.getElementById('createFirstJob').addEventListener('click', () => {
                            document.getElementById('newJobBtn').click();
                        });
                    }
                    
                    document.getElementById('paginationContainer').classList.add('hidden');
                    document.getElementById('bulkActionsContainer').classList.add('hidden');
                    return;
                }
                
                // Pagination
                const totalPages = Math.ceil(currentJobs.length / jobsPerPage);
                const paginatedJobs = currentJobs.slice(
                    (page - 1) * jobsPerPage,
                    page * jobsPerPage
                );
                
                renderJobListings(paginatedJobs);
                updatePaginationControls(totalPages);
                
                // Show bulk actions if there are jobs
                document.getElementById('bulkActionsContainer').classList.remove('hidden');
                
            } catch (error) {
                console.error("Error loading jobs:", error);
                jobListings.innerHTML = `
                    <div class="text-center py-8 text-red-500">
                        <i class="fas fa-exclamation-circle mr-2"></i>
                        Error loading jobs. Please try again.
                    </div>
                `;
                document.getElementById('paginationContainer').classList.add('hidden');
                document.getElementById('bulkActionsContainer').classList.add('hidden');
            }
        }

        function renderJobListings(jobs) {
            const jobListings = document.getElementById('jobListings');
            jobListings.innerHTML = '';
            
            jobs.forEach(job => {
                const jobCard = document.createElement('div');
                jobCard.className = `job-card bg-white rounded-lg shadow p-6 ${job.promoted ? 'promoted-job' : ''}`;
                jobCard.innerHTML = `
                    <div class="flex items-start justify-between">
                        <div class="flex items-center">
                            <input type="checkbox" class="job-checkbox mr-3 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" data-job-id="${job.id}" ${selectedJobs.includes(job.id) ? 'checked' : ''}>
                            <div>
                                <div class="flex items-center">
                                    <h3 class="text-lg font-medium text-gray-900">${job.title}</h3>
                                    ${job.promoted ? '<span class="ml-2 text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded">Promoted</span>' : ''}
                                </div>
                                <div class="job-details mt-2 text-sm text-gray-600">
                                    <span class="mr-3"><i class="fas fa-map-marker-alt mr-1"></i> ${job.location}</span>
                                    <span class="mr-3"><i class="fas fa-dollar-sign mr-1"></i> ${job.salary || 'Salary not specified'}</span>
                                    <span class="mr-3"><i class="fas fa-briefcase mr-1"></i> ${formatJobType(job.type)}</span>
                                </div>
                                <div class="mt-2 flex flex-wrap gap-2">
                                    <span class="status-badge ${getStatusClass(job.status)}">${formatStatus(job.status)}</span>
                                    <span class="text-xs text-gray-500">
                                        <i class="far fa-clock mr-1"></i> ${formatDate(job.updatedAt?.toDate())}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button class="edit-job text-blue-600 hover:text-blue-800 text-sm font-medium" data-job-id="${job.id}">
                                <i class="fas fa-edit mr-1"></i> Edit
                            </button>
                            ${job.status === 'active' ? 
                                `<button class="archive-job text-gray-600 hover:text-gray-800 text-sm font-medium" data-job-id="${job.id}">
                                    <i class="fas fa-archive mr-1"></i> Archive
                                </button>` : ''}
                            ${job.status === 'archived' ? 
                                `<button class="publish-job text-green-600 hover:text-green-800 text-sm font-medium" data-job-id="${job.id}">
                                    <i class="fas fa-upload mr-1"></i> Publish
                                </button>` : ''}
                            <button class="delete-job text-red-600 hover:text-red-800 text-sm font-medium" data-job-id="${job.id}">
                                <i class="fas fa-trash-alt mr-1"></i> Delete
                            </button>
                        </div>
                    </div>
                `;
                jobListings.appendChild(jobCard);
            });
            
            // Add event listeners to the newly created elements
            setupJobCardEventListeners();
        }

        function setupJobCardEventListeners() {
            // Checkbox selection
            document.querySelectorAll('.job-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const jobId = this.dataset.jobId;
                    if (this.checked) {
                        if (!selectedJobs.includes(jobId)) {
                            selectedJobs.push(jobId);
                        }
                    } else {
                        selectedJobs = selectedJobs.filter(id => id !== jobId);
                    }
                    updateSelectedCount();
                });
            });
            
            // Edit job
            document.querySelectorAll('.edit-job').forEach(btn => {
                btn.addEventListener('click', async function() {
                    const jobId = this.dataset.jobId;
                    await loadJobForEditing(jobId);
                });
            });
            
            // Archive job
            document.querySelectorAll('.archive-job').forEach(btn => {
                btn.addEventListener('click', function() {
                    const jobId = this.dataset.jobId;
                    showConfirmation(
                        'Archive Job',
                        'Are you sure you want to archive this job? It will no longer be visible to applicants.',
                        () => updateJobStatus(jobId, 'archived')
                    );
                });
            });
            
            // Publish job
            document.querySelectorAll('.publish-job').forEach(btn => {
                btn.addEventListener('click', function() {
                    const jobId = this.dataset.jobId;
                    showConfirmation(
                        'Publish Job',
                        'Are you sure you want to publish this job? It will be visible to applicants.',
                        () => updateJobStatus(jobId, 'active')
                    );
                });
            });
            
            // Delete job
            document.querySelectorAll('.delete-job').forEach(btn => {
                btn.addEventListener('click', function() {
                    const jobId = this.dataset.jobId;
                    showConfirmation(
                        'Delete Job',
                        'Are you sure you want to delete this job? This action cannot be undone.',
                        () => deleteJob(jobId)
                    );
                });
            });
        }

        function updatePaginationControls(totalPages) {
            const paginationContainer = document.getElementById('paginationContainer');
            const pageInfo = document.getElementById('pageInfo');
            const prevPageBtn = document.getElementById('prevPage');
            const nextPageBtn = document.getElementById('nextPage');
            
            if (totalPages > 1) {
                paginationContainer.classList.remove('hidden');
                pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
                
                prevPageBtn.disabled = currentPage === 1;
                nextPageBtn.disabled = currentPage === totalPages;
            } else {
                paginationContainer.classList.add('hidden');
            }
        }

        function updateSelectedCount() {
            const selectedCount = document.getElementById('selectedCount');
            selectedCount.textContent = `${selectedJobs.length} selected`;
            
            // Enable/disable bulk action button
            document.getElementById('applyBulkAction').disabled = selectedJobs.length === 0;
        }

        async function loadJobForEditing(jobId) {
            try {
                const docRef = doc(db, "jobs", jobId);
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    const job = docSnap.data();
                    
                    document.getElementById('editorTitle').textContent = 'Edit Job Post';
                    document.getElementById('jobId').value = jobId;
                    document.getElementById('jobTitle').value = job.title || '';
                    document.getElementById('jobLocation').value = job.location || '';
                    document.getElementById('jobSalary').value = job.salary || '';
                    document.getElementById('jobType').value = job.type || '';
                    document.getElementById('jobCategory').value = job.category || '';
                    document.getElementById('jobDeadline').value = job.deadline ? job.deadline.split('T')[0] : '';
                    document.getElementById('jobVacancies').value = job.vacancies || '';
                    document.getElementById('promoteJob').checked = job.promoted || false;
                    
                    // Set required documents checkboxes
                    if (job.requiredDocuments) {
                        document.getElementById('reqResume').checked = job.requiredDocuments.includes('resume');
                        document.getElementById('reqCoverLetter').checked = job.requiredDocuments.includes('coverLetter');
                        document.getElementById('reqPortfolio').checked = job.requiredDocuments.includes('portfolio');
                    } else {
                        document.getElementById('reqResume').checked = false;
                        document.getElementById('reqCoverLetter').checked = false;
                        document.getElementById('reqPortfolio').checked = false;
                    }
                    
                    // Load description into Quill
                    quill.root.innerHTML = job.description || '';
                    
                    // Show the editor
                    document.getElementById('jobEditorModal').classList.remove('hidden');
                } else {
                    showToast('Job not found', 'error');
                }
            } catch (error) {
                console.error("Error loading job:", error);
                showToast('Error loading job details', 'error');
            }
        }

        async function saveJob(jobData, status = 'draft') {
            try {
                jobData.companyId = auth.currentUser.uid;
                jobData.updatedAt = serverTimestamp();
                jobData.status = status;
                
                // Get required documents
                const requiredDocuments = [];
                if (document.getElementById('reqResume').checked) requiredDocuments.push('resume');
                if (document.getElementById('reqCoverLetter').checked) requiredDocuments.push('coverLetter');
                if (document.getElementById('reqPortfolio').checked) requiredDocuments.push('portfolio');
                jobData.requiredDocuments = requiredDocuments;
                
                // Process description
                jobData.description = quill.root.innerHTML;
                
                // Process deadline date
                if (jobData.deadline) {
                    jobData.deadline = new Date(jobData.deadline).toISOString();
                }
                
                // Process vacancies
                if (jobData.vacancies) {
                    jobData.vacancies = parseInt(jobData.vacancies);
                }
                
                // Process promoted status
                jobData.promoted = document.getElementById('promoteJob').checked;

                if (jobData.id) {
                    // Update existing job
                    const jobRef = doc(db, "jobs", jobData.id);
                    await updateDoc(jobRef, jobData);
                    showToast('Job updated successfully!', 'success');
                } else {
                    // Create new job
                    jobData.postedAt = serverTimestamp();
                    jobData.applications = [];
                    await addDoc(collection(db, "jobs"), jobData);
                    showToast('Job created successfully!', 'success');
                }
                
                return true;
            } catch (error) {
                console.error("Error saving job:", error);
                showToast('Error saving job: ' + error.message, 'error');
                return false;
            }
        }

        async function updateJobStatus(jobId, status) {
            try {
                const jobRef = doc(db, "jobs", jobId);
                await updateDoc(jobRef, {
                    status: status,
                    updatedAt: serverTimestamp()
                });
                showToast(`Job ${status} successfully`, 'success');
                loadJobs(currentStatus, currentPage);
            } catch (error) {
                console.error("Error updating job status:", error);
                showToast('Error updating job status', 'error');
            }
        }

        async function deleteJob(jobId) {
            try {
                const jobRef = doc(db, "jobs", jobId);
                await deleteDoc(jobRef);
                showToast('Job deleted successfully', 'success');
                loadJobs(currentStatus, currentPage);
            } catch (error) {
                console.error("Error deleting job:", error);
                showToast('Error deleting job', 'error');
            }
        }

        async function performBulkAction(action) {
            if (selectedJobs.length === 0) {
                showToast('No jobs selected', 'error');
                return;
            }
            
            const loadingId = showToast(`Processing ${selectedJobs.length} jobs...`, 'info', 0);
            
            try {
                const batch = writeBatch(db);
                
                for (const jobId of selectedJobs) {
                    const jobRef = doc(db, "jobs", jobId);
                    
                    switch(action) {
                        case 'publish':
                            batch.update(jobRef, { 
                                status: 'active',
                                updatedAt: serverTimestamp() 
                            });
                            break;
                        case 'archive':
                            batch.update(jobRef, { 
                                status: 'archived',
                                updatedAt: serverTimestamp() 
                            });
                            break;
                        case 'delete':
                            batch.delete(jobRef);
                            break;
                        case 'promote':
                            batch.update(jobRef, { 
                                promoted: true,
                                updatedAt: serverTimestamp() 
                            });
                            break;
                        default:
                            break;
                    }
                }
                
                await batch.commit();
                dismissToast(loadingId);
                showToast(`Bulk action completed for ${selectedJobs.length} jobs`, 'success');
                
                // Clear selection and reload
                selectedJobs = [];
                updateSelectedCount();
                loadJobs(currentStatus, currentPage);
                
            } catch (error) {
                dismissToast(loadingId);
                console.error("Bulk action failed:", error);
                showToast('Bulk action failed: ' + error.message, 'error');
            }
        }

        // ===== Initialize Application =====
        document.addEventListener('DOMContentLoaded', () => {
            // Check auth state
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    // User is signed in, initialize the app
                    initializeAppComponents();
                    // Load initial jobs
                    loadJobs(currentStatus);
                } else {
                    // User is signed out - redirect to login
                    window.location.href = '../login/login.html';
                }
            });
        });

        function initializeAppComponents() {
            // Tab switching
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active class from all tabs
                    document.querySelectorAll('.tab-btn').forEach(t => {
                        t.classList.remove('active', 'bg-blue-100', 'text-blue-700');
                    });
                    
                    // Add active class to clicked tab
                    this.classList.add('active', 'bg-blue-100', 'text-blue-700');
                    
                    // Load jobs for this status
                    loadJobs(this.dataset.status);
                });
            });

            // New Job Button
            document.getElementById('newJobBtn').addEventListener('click', () => {
                // Reset form
                document.getElementById('jobForm').reset();
                document.getElementById('editorTitle').textContent = 'New Job Post';
                document.getElementById('jobId').value = '';
                quill.root.innerHTML = '';
                
                // Show modal
                document.getElementById('jobEditorModal').classList.remove('hidden');
            });

            // Form Submission
            document.getElementById('jobForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const formData = {
                    id: document.getElementById('jobId').value,
                    title: document.getElementById('jobTitle').value,
                    location: document.getElementById('jobLocation').value,
                    salary: document.getElementById('jobSalary').value,
                    type: document.getElementById('jobType').value,
                    category: document.getElementById('jobCategory').value,
                    deadline: document.getElementById('jobDeadline').value,
                    vacancies: document.getElementById('jobVacancies').value
                };

                const success = await saveJob(formData, 'active');
                if (success) {
                    document.getElementById('jobEditorModal').classList.add('hidden');
                    loadJobs(currentStatus);
                }
            });

            // Save Draft Button
            document.getElementById('saveDraft').addEventListener('click', async (e) => {
                e.preventDefault();
                
                const formData = {
                    id: document.getElementById('jobId').value,
                    title: document.getElementById('jobTitle').value,
                    location: document.getElementById('jobLocation').value,
                    salary: document.getElementById('jobSalary').value,
                    type: document.getElementById('jobType').value,
                    category: document.getElementById('jobCategory').value,
                    deadline: document.getElementById('jobDeadline').value,
                    vacancies: document.getElementById('jobVacancies').value
                };

                const success = await saveJob(formData, 'draft');
                if (success) {
                    document.getElementById('jobEditorModal').classList.add('hidden');
                    loadJobs(currentStatus);
                }
            });

            // Publish Job Button
            document.getElementById('publishJob').addEventListener('click', async (e) => {
                e.preventDefault();
                
                const formData = {
                    id: document.getElementById('jobId').value,
                    title: document.getElementById('jobTitle').value,
                    location: document.getElementById('jobLocation').value,
                    salary: document.getElementById('jobSalary').value,
                    type: document.getElementById('jobType').value,
                    category: document.getElementById('jobCategory').value,
                    deadline: document.getElementById('jobDeadline').value,
                    vacancies: document.getElementById('jobVacancies').value
                };

                const success = await saveJob(formData, 'active');
                if (success) {
                    document.getElementById('jobEditorModal').classList.add('hidden');
                    loadJobs(currentStatus);
                }
            });

            // Modal Close Buttons
            document.getElementById('closeEditor').addEventListener('click', () => {
                document.getElementById('jobEditorModal').classList.add('hidden');
            });

            document.getElementById('closeConfirmation').addEventListener('click', () => {
                document.getElementById('confirmationModal').classList.add('hidden');
            });

            document.getElementById('cancelAction').addEventListener('click', () => {
                document.getElementById('confirmationModal').classList.add('hidden');
            });

            // Pagination Controls
            document.getElementById('prevPage').addEventListener('click', () => {
                if (currentPage > 1) {
                    loadJobs(currentStatus, currentPage - 1);
                }
            });

            document.getElementById('nextPage').addEventListener('click', () => {
                const totalPages = Math.ceil(currentJobs.length / jobsPerPage);
                if (currentPage < totalPages) {
                    loadJobs(currentStatus, currentPage + 1);
                }
            });

            // Bulk Actions
            document.getElementById('applyBulkAction').addEventListener('click', () => {
                const action = document.getElementById('bulkActionSelect').value;
                if (action && selectedJobs.length > 0) {
                    performBulkAction(action);
                }
            });

            // Clear Selection
            document.getElementById('clearSelection').addEventListener('click', () => {
                selectedJobs = [];
                document.querySelectorAll('.job-checkbox').forEach(cb => cb.checked = false);
                updateSelectedCount();
            });

            // Set initial active tab
            document.querySelector('.tab-btn[data-status="draft"]').classList.add('active', 'bg-blue-100', 'text-blue-700');
        }
    </script>
</body>
</html>